# Run Log: 2026-02-04 05:35

## Focus
Issue #23: [Bug] Degradation service incorrectly shows Ollama as available when it's not running

## Changes
- `assistant/server/services/degradation.py`:
  - Changed Ollama `APIHealth` initialization to `available=False` (line 128)
  - Added `initialize_ollama_status()` async method to check actual Ollama availability (lines 143-162)
  - Updated `reset_api_health()` to reset Ollama to unavailable while cloud APIs reset to available (lines 622-641)

- `assistant/server/main.py`:
  - Added call to `degradation_svc.initialize_ollama_status()` during server startup (lines 59-62)

- `assistant/tests/test_degradation.py`:
  - Added `test_init_ollama_unavailable_by_default`: Verifies Ollama starts unavailable
  - Added `test_initialize_ollama_status_available`: Tests setting available when running
  - Added `test_initialize_ollama_status_unavailable`: Tests keeping unavailable when not running
  - Added `test_initialize_ollama_status_handles_exception`: Tests graceful error handling
  - Added `test_reset_ollama_specific_stays_unavailable`: Tests Ollama-specific reset
  - Updated `test_reset_api_health_all`: Verifies Ollama stays unavailable after reset

## Result
SUCCESS - Issue #23 implementation complete. Bug fixed:
- [x] Ollama now defaults to `available=False` until verified
- [x] Server startup checks actual Ollama availability
- [x] `/api/degradation` and `/api/ollama/status` are now consistent
- [x] Reset operations maintain correct semantics
- [x] 7 new tests added (67 total in test_degradation.py)
- [x] All 713 tests passing

## Root Cause
The `DegradationService.__init__()` created Ollama health with `available=True` by default (inherited from `APIHealth` dataclass default), but never verified actual Ollama availability. This led to inconsistency between `/api/degradation` (always showing available) and `/api/ollama/status` (correctly detecting status).

## How to Test
```bash
cd $GENESIS_DIR/assistant

# Run Ollama-related tests
python3 -m pytest tests/test_degradation.py -v -k ollama

# Manual test without Ollama running
python3 -m server.main &
sleep 3
curl http://127.0.0.1:8080/api/degradation | jq '.apis.ollama.available'
# Expected: false

curl http://127.0.0.1:8080/api/ollama/status | jq '.status'
# Expected: "unavailable"

pkill -f 'python3 -m server.main'
```

## Next
Issue #23 labeled `needs-verification` for Criticizer verification.
